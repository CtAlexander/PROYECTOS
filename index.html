<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aceites y L√≠pidos BD</title>
    <style>
        /* Marca de agua */
        .marca-de-agua {
            position: fixed;
            bottom: 0;
            right: 0;
            margin: 10px;
            opacity: 0.2;
            font-size: 50px;
            color: black;
            pointer-events: none;
        }

        /* Body Styling */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #2a3c4f;
            color: #d0d0d0;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 5%;
            background-size: cover;
            position: relative;
        }

        /* Onda verde en la pared izquierda */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 50%;
            height: 100%;
            background: radial-gradient(circle at 20% 50%, #00b954, transparent 70%);
            opacity: 0.15;
            z-index: -1;
        }

        /* Info Container */
        .info-container {
            color: #ffffff;
            max-width: 500px;
            margin-right: 5%;
        }

        .info-container h1 {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #00b954;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }

        .info-container ul {
            list-style-type: none;
            padding: 0;
        }

        .info-container li {
            margin-bottom: 20px;
            font-size: 18px;
        }

        .info-container li:before {
            content: '‚úîÔ∏è';
            color: #00ed64;
            margin-right: 10px;
        }

        /* Login/Signin Containers */
        .login-container, .signin-container {
            background-color: #ffffff;
            padding: 35px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            color: #000000;
            text-align: center;
            max-width: 400px;
            width: 100%;
        }

        h1 {
            color: #00b954;
            margin-bottom: 20px;
        }

        input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: #f9f9f9;
            color: #333;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus {
            border-color: #00b954;
            outline: none;
        }

        /* Bot√≥n */
        .button {
            width: 100%;
            padding: 15px;
            background-color: #00b954;
            color: #fff;
            border: none;
            cursor: pointer;
            border-radius: 8px;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }

        .button:hover {
            background-color: #009847;
        }

        /* Loading Container */
        .loading-container {
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 999;
        }

        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #00ed64;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Menu Container */
        .menu-container {
            display: none;
            background-color: transparent;
            padding: 40px;
            box-sizing: border-box;
            color: #000000;
            width: 100vw;
            height: 100vh;
            overflow-y: auto;
        }

        /* Tabs */
        .tabs {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }

        .tabs div {
            padding: 10px 20px;
            background-color: #4b5e6e;
            color: #fff;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .tabs div.active {
            background-color: #00b954;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Table Styling */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 16px;
            color: #333;
        }

        table th, table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        table td {
            color: #00b954;
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        /* Links */
        .file-link {
            color: #00b954;
            text-decoration: none;
            transition: text-decoration 0.2s;
        }

        .file-link:hover {
            text-decoration: underline;
        }

        .no-file {
            color: #a9a9a9;
        }

        /* Switch Container */
        .switch-container {
            margin-top: 20px;
            text-align: center;
        }

        .switch-container a {
            color: #00b954;
            cursor: pointer;
            font-weight: bold;
            transition: color 0.3s ease;
        }

        .switch-container a:hover {
            color: #009847;
        }

        /* User Box */
        .user-box {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px;
            background-color: #00b954;
            color: #ffffff;
            border-radius: 50%;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s ease;
        }

        .user-box:hover {
            background-color: #009847;
        }

        /* Dropdown Menu */
        .dropdown-menu {
            display: none;
            position: absolute;
            top: 60px;
            right: 20px;
            background-color: #2a3c4f;
            border-radius: 8px;
            width: 200px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            color: #ffffff;
            font-size: 14px;
            z-index: 1000;
        }

        .dropdown-menu a {
            display: block;
            padding: 10px 15px;
            color: #ffffff;
            text-decoration: none;
            border-bottom: 1px solid #444;
        }

        .dropdown-menu a:hover {
            background-color: #00b954;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1001;
            padding-top: 60px;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(3px);
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .close:hover,
        .close:focus {
            color: #000;
        }

        /* Contenedor principal del organigrama */
        .organigrama-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }

/* Nuevo bot√≥n de tres puntos */
        .three-dots-menu {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 24px;
            cursor: pointer;
        }

        .three-dots-dropdown {
            display: none;
            position: absolute;
            top: 50px;
            left: 20px;
            background-color: #2a3c4f;
            color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .three-dots-dropdown a {
            display: block;
            padding: 10px 15px;
            color: #ffffff;
            text-decoration: none;
            border-bottom: 1px solid #444;
        }

        .three-dots-dropdown a:hover {
            background-color: #00b954;
        }

        .three-dots-dropdown a:last-child {
            border-bottom: none;
        }

       
    /* Estilo general del modal */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 9999;
        backdrop-filter: blur(8px);
        justify-content: center;
        align-items: center;
    }

    .modal-content {
        background: #ffffff;
        padding: 30px;
        border-radius: 15px;
        width: 90%;
        max-width: 400px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        text-align: center;
    }

    .modal-content h2 {
        margin-bottom: 20px;
        font-size: 24px;
        color: #00b954;
        text-transform: uppercase;
        font-weight: bold;
        letter-spacing: 1px;
    }

    .modal-content ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .modal-content ul li {
        margin: 15px 0;
    }

    .modal-content ul li a {
        text-decoration: none;
        font-size: 18px;
        font-weight: bold;
        color: #333;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 10px;
        border: 2px solid #00b954;
        border-radius: 8px;
        transition: all 0.3s ease;
    }

    .modal-content ul li a:hover {
        background: #00b954;
        color: #ffffff;
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    .modal-content ul li a img {
        margin-right: 10px;
    }

    .modal-content .close {
        position: absolute;
        top: 15px;
        right: 15px;
        font-size: 20px;
        color: #333;
        cursor: pointer;
        font-weight: bold;
        transition: color 0.3s ease;
    }

    .modal-content .close:hover {
        color: #00b954;
    }
/* Estilo del bot√≥n */
#normasIsoButton {
    background-color: #28a745; /* Color verde principal */
    color: #FFFFFF; /* Texto blanco */
    font-family: 'Arial', sans-serif; /* Fuente profesional */
    font-size: 14px; /* Tama√±o del texto m√°s peque√±o */
    padding: 10px 15px; /* Espaciado interno reducido */
    border: none; /* Sin borde */
    border-radius: 6px; /* Bordes redondeados */
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Sombra m√°s peque√±a */
    cursor: pointer; /* Cambia el cursor al pasar */
    display: inline-block; /* Mantenerlo en l√≠nea */
    text-align: center; /* Centrar el contenido */
    transition: background-color 0.3s, box-shadow 0.3s; /* Efectos suaves */
    position: absolute; /* Posicionamiento absoluto */
    top: 20px; /* Despegado de la parte superior */
    right: 80px; /* Separado 50px de la esquina derecha */
}

/* Hover del bot√≥n */
#normasIsoButton:hover {
    background-color: #218838; /* Verde m√°s oscuro al pasar */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15); /* Aumenta la sombra */
}

/* Activo al presionar */
#normasIsoButton:active {
    background-color: #1e7e34; /* Verde m√°s intenso */
    box-shadow: 0 2px 3px rgba(0, 0, 0, 0.2); /* Reduce la sombra */
}

#pdfModal iframe {
    border: none;
}

.search-container {
    margin: 20px 0;
    display: flex;
    gap: 10px;
    align-items: center;
}

#searchInput {
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    flex-grow: 1;
}

#searchButton {
    padding: 10px 20px;
    background-color: #00b954;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

#searchButton:hover {
    background-color: #009847;
}

.green-button {
    background-color: #28a745; /* Verde brillante */
    color: white; /* Texto blanco */
    border: none; /* Sin bordes */
    padding: 10px 20px; /* Espaciado interno */
    font-size: 16px; /* Tama√±o de fuente */
    font-weight: bold; /* Negrita */
    border-radius: 5px; /* Bordes redondeados */
    cursor: pointer; /* Cambia el cursor al pasar sobre el bot√≥n */
    transition: background-color 0.3s ease; /* Animaci√≥n al pasar el rat√≥n */
}

.green-button:hover {
    background-color: #218838; /* Verde m√°s oscuro al pasar el rat√≥n */
}

.green-button:active {
    background-color: #1e7e34; /* Verde a√∫n m√°s oscuro al hacer clic */
}

.pagination-button {
    display: inline-block;
    padding: 10px 15px;
    margin: 5px;
    background-color: #00b954; /* Verde */
    color: #ffffff; /* Blanco */
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.3s;
}

.pagination-button:hover {
    background-color: #009847; /* Verde m√°s oscuro */
}

.pagination-button.active {
    background-color: #009847;
}

.green-button {
    background-color: #28a745; /* Verde brillante */
    color: white; /* Texto blanco */
    border: none; /* Sin bordes */
    padding: 10px 20px; /* Espaciado interno */
    font-size: 16px; /* Tama√±o de fuente */
    font-weight: bold; /* Negrita */
    border-radius: 5px; /* Bordes redondeados */
    cursor: pointer; /* Cambia el cursor al pasar sobre el bot√≥n */
    transition: background-color 0.3s ease; /* Animaci√≥n al pasar el rat√≥n */
    margin: 5px 0; /* Espaciado vertical entre botones */
}

.green-button:hover {
    background-color: #218838; /* Verde m√°s oscuro al pasar el rat√≥n */
}

.green-button:active {
    background-color: #1e7e34; /* Verde a√∫n m√°s oscuro al hacer clic */
}

.tabs {
    display: flex;
    justify-content: space-between;
    margin-bottom: 20px;
}

.tabs div {
    flex: 1;
    padding: 10px;
    text-align: center;
    background-color: #4b5e6e;
    color: white;
    border-radius: 5px;
    margin-right: 5px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.3s ease;
}

.tabs div.active {
    background-color: #00b954;
    color: white;
}

#requisitos-content {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    width: 100%; /* Asegura que ocupe todo el ancho disponible */
    margin: 0 auto; /* Centra horizontalmente */
    padding: 20px; /* Espaciado interno */
}

.tabs {
    display: flex;
    justify-content: center; /* Centra horizontalmente */
    gap: 10px; /* Espacio entre pesta√±as */
    margin-bottom: 20px; /* Espaciado debajo de las pesta√±as */
}

.tabs div {
    padding: 10px 20px;
    text-align: center;
    background-color: #4b5e6e; /* Fondo de las pesta√±as */
    color: white;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.3s ease;
}

.tabs div.active {
    background-color: #00b954; /* Color de la pesta√±a activa */
}

h2 {
    color: #00b954; /* Verde del encabezado */
    margin-bottom: 20px;
    text-align: center;



.tabs {
    display: flex;
    justify-content: center; /* Centra las pesta√±as horizontalmente */
    gap: 10px; /* Espacio entre las pesta√±as */
    margin-bottom: 20px;
}

.tabs div {
    padding: 10px 20px;
    text-align: center;
    background-color: rgba(75, 94, 110, 0.7); /* Fondo semitransparente */
    color: white;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.3s ease;
}

.tabs div.active {
    background-color: rgba(0, 185, 84, 0.7); /* Fondo activo semitransparente */
}


.tab-content {
    display: none;
    text-align: center; /* Centra el contenido dentro de cada pesta√±a */
    margin: 0 auto;
    background-color: rgba(0, 0, 0, 0.2); /* Fondo del contenido semitransparente */
    border-radius: 10px; /* Bordes redondeados */
    padding: 20px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); /* Sombra ligera */
}

.tab-content.active {
    display: block;
}

#content-mapa {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    height: 100%;
    padding: 20px;
    background-color: rgba(255, 255, 255, 0.1); /* Fondo transparente */
    text-align: center;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); /* Sombra ligera */
}


#requisitos-content {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    width: 100%;
    margin: 0 auto;
    padding: 20px;
    background-color: rgba(0, 0, 0, 0.1); /* Fondo semitransparente */
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); /* Sombra ligera */
}


/* Tabs */
.tabs {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px; /* Espacio entre pesta√±as */
    margin-bottom: 20px;
}

.tabs div {
    padding: 10px 20px;
    text-align: center;
    background-color: rgba(75, 94, 110, 0.7);
    color: white;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.3s ease;
}

.tabs div.active {
    background-color: rgba(0, 185, 84, 0.7);
}

.tab-content {
    display: none;
    text-align: center;
    margin: 0 auto;
    background-color: rgba(0, 0, 0, 0.2);
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.tab-content.active {
    display: block;
}

#content-mapa {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    height: 100%;
    padding: 20px;
    background-color: rgba(255, 255, 255, 0.1);
    text-align: center;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

#requisitos-content {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    width: 100%;
    margin: 0 auto;
    padding: 20px;
    background-color: rgba(0, 0, 0, 0.1);
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}



/* Ajustar la posici√≥n de las pesta√±as */
.tabs {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin: 0; /* Sin margen */
    padding: 10px 0;
    position: sticky; /* Fijo en la parte superior */
    top: 0;
    background-color: rgba(0, 0, 0, 0.8); /* Fondo semitransparente */
    z-index: 10;
}

/* Pesta√±as individuales */
.tabs div {
    padding: 10px 20px;
    text-align: center;
    background-color: rgba(75, 94, 110, 0.7); /* Fondo semitransparente */
    color: white;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.3s ease;
}

.tabs div.active {
    background-color: rgba(0, 185, 84, 0.7); /* Fondo activo semitransparente */
}

/* Contenido de las pesta√±as */
.tab-content {
    display: none;
    margin-top: 10px;
    padding: 20px;
    background-color: rgba(0, 0, 0, 0.1); /* Fondo semitransparente */
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); /* Sombra ligera */
}

/* Mostrar el contenido activo */
.tab-content.active {
    display: block;
}

/* Contenido espec√≠fico para el Mapa de Procesos */
#content-mapa {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    text-align: center;
    margin-top: 20px;
}

#mapa-procesos-img {
    max-width: 80%;
    height: auto;
    border: 2px solid #ddd; /* Borde decorativo */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Sombra para la imagen */

 }
   
#content-mapa {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    height: 100%;
    padding: 20px;
    background-color: transparent; /* Fondo transparente */
    text-align: center;
    border-radius: 10px; /* Opcional: Bordes redondeados */
    box-shadow: none; /* Elimina cualquier sombra */
}

#mapa-procesos-img {
    max-width: 90%; /* Ajusta al tama√±o del contenedor */
    height: auto;
    border: none; /* Elimina cualquier borde */
    box-shadow: none; /* Elimina cualquier sombra */
    background-color: transparent; /* Asegura que no haya fondo en la imagen */
}

/* Letras negras solo en el modal del perfil */
#profileModal p, #profileModal h2, #profileModal span {
    color: #000000; /* Cambiar a negro */
}

/* Aseguramos que los textos dentro del modal tengan el estilo */
#profileModal strong {
    color: #000000; /* T√≠tulos destacados en negro */
}

/* Fondo del modal */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.8); /* Fondo oscuro */
}

/* Contenedor del modal */
.modal-content {
    background-color: #fff;
    margin: auto;
    padding: 0;
    border-radius: 8px;
    width: 95%; /* Ocupa el 95% del ancho de la pantalla */
    height: 95%; /* Ocupa el 95% de la altura de la pantalla */
    text-align: center;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    overflow: hidden;
    position: relative;
}

/* Encabezado del modal */
#orgChartHeader {
    margin: 0;
    padding: 10px;
    font-size: 24px;
    background-color: #f4f4f4;
    text-align: center;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

/* Iframe del PDF */
iframe {
    width: 100%; /* Ocupa todo el ancho del contenedor */
    height: calc(100% - 50px); /* Altura restante despu√©s del encabezado */
    border: none;
}

#alfaAssistant {
    background: linear-gradient(135deg, #28a745, #218838); /* Gradiente verde */
    color: #ffffff; /* Texto blanco */
    font-size: 16px; /* Tama√±o de fuente ligeramente m√°s grande */
    font-weight: bold;
    text-align: center;
    border-radius: 50%;
    width: 60px; /* Bot√≥n m√°s grande para mayor visibilidad */
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    position: absolute;
    top: 20px;
    right: 30px; /* Ajuste para moverlo m√°s a la izquierda */
    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2); /* Sombra m√°s pronunciada */
    transition: all 0.3s ease;
}

#alfaAssistant:hover {
    background: linear-gradient(135deg, #218838, #1e7e34); /* Gradiente m√°s oscuro en hover */
    transform: scale(1.1); /* Aumenta el tama√±o ligeramente */
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3); /* Sombra m√°s intensa */
}

#alfaAssistant:active {
    transform: scale(0.95); /* Leve reducci√≥n al hacer clic */
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2); /* Reduce la sombra */
}




</style>

</style>

    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
</head>
<body>

<div id="pdfModal" class="modal">
    <div class="modal-content" style="width: 90%; height: 90%; max-width: 1200px; max-height: 800px;">
        <span class="close" id="closePdfModal">&times;</span>
        <h2>Normas ISO</h2>

        <!-- Selector de Normas -->
        <select id="normasSelector">
            <option value="iso9001">ISO 9001:2015</option>
            <option value="iso22000">ISO 22000:2018</option>
        </select>

        <!-- Buscador en el documento -->
        <div class="search-container" style="margin: 20px 0; display: flex; gap: 10px;">
            <input type="text" id="searchInput" placeholder="Buscar en el documento" style="flex-grow: 1; padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
            <button id="searchButton" style="padding: 10px 20px; background-color: #00b954; color: white; border: none; border-radius: 5px; cursor: pointer;">Buscar</button>
        </div>

        <div style="margin: 20px 0; display: flex; justify-content: center; gap: 20px;">
    <button id="prevMatchButton" style="padding: 10px; font-size: 18px;">‚¨ÖÔ∏è Anterior</button>
    <button id="nextMatchButton" style="padding: 10px; font-size: 18px;">‚û°Ô∏è Siguiente</button>
</div>
<div id="pdfViewerContainer" style="width: 100%; height: auto; overflow-y: auto;"></div>

    </div>
</div>








    <!-- Contenedor de usuario y men√∫ desplegable -->
    <div class="user-box" id="user-box">üë§</div>
      <div class="user-box" id="normasIsoButton">üìú Normas ISO</div>
      

    <div class="dropdown-menu" id="dropdown-menu">
        <a href="#" id="viewProfile">Ver mi perfil</a>
        <a href="#" id="openOrgChart">Ver mi puesto y responsabilidades</a>
         <a href="#" id="alfaAssistant">ü§ñ Alfa</a>
        <a href="#" id="logout">Cerrar sesi√≥n</a>
        
    </div>
    <div class="marca-de-agua">Œ±4</div>

   <!-- Modal para el organigrama -->
<div id="orgChartModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close" id="closeOrgChart">&times;</span>
        <!-- Encabezado -->
        <h2 id="orgChartHeader">Organigrama</h2>
        <!-- Iframe para el PDF -->
        <iframe 
            id="orgChartIframe"
            src="https://firebasestorage.googleapis.com/v0/b/plataforma-39bde.appspot.com/o/OrganigramaDiciembre2024.pdf?alt=media&token=299b33c5-1560-4972-b9ec-0480fe71c63e"
            title="Organigrama">
        </iframe>
    </div>
</div>


  <!-- Modal para el perfil de usuario -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeProfile">&times;</span>
            <h2>Mi Perfil</h2>
            <p><strong>Nombre:</strong> <span id="userName"></span></p>
            <p><strong>Apellido:</strong> <span id="userLastName"></span></p>
            <p><strong>Rol:</strong> <span id="userRole"></span></p>
            <p><strong>Correo Electr√≥nico:</strong> <span id="userEmail"></span></p>
        </div>
    </div>

    <!-- Contenedor de la informaci√≥n -->
    <div class="info-container" id="info-container">
        <h1>Aceites y L√≠pidos BD</h1>
        <ul>
            <li>
                <p><strong>Pol√≠tica de calidad y inocuidad</strong><br>
                Nos comprometemos a proveer aceites y mantecas comestibles desarrollando y adecuando las formulaciones de nuevos productos mediante el cumplimiento de las regulaciones nacionales.</p>
            </li>
            <li>
                <p>Gesti√≥n de los impactos del cambio clim√°tico en nuestros procesos y resultados, y comunicaci√≥n con todas las partes interesadas para satisfacer sus necesidades y expectativas y lograr la mejora continua.</p>
            </li>
            <li>
                <p>Asimismo otorgamos asesor√≠a para el manejo de nuestra gama de productos y desarrollos, generando total confianza y satisfacci√≥n plena en nuestros clientes.</p>
            </li>
        </ul>
    </div>

    <!-- Contenedor de login y registro -->
    <div class="login-container" id="register-screen">
        <h1>Crear cuenta</h1>
        <input type="text" id="nombre" placeholder="Nombre" required>
        <input type="text" id="apellido" placeholder="Apellido" required>
        <input type="text" id="rol" placeholder="Rol" required>
        <input type="email" id="email" placeholder="Correo Electr√≥nico" required>
        <input type="password" id="password" placeholder="Contrase√±a" required>
        <button class="button" id="registerBtn">Crear cuenta</button>
        <div class="switch-container">
            <p>¬øYa tienes cuenta? <a id="switchToSignIn">Iniciar sesi√≥n</a></p>
        </div>
    </div>

    <div class="signin-container" id="signin-screen" style="display: none;">
        <h1>Iniciar sesi√≥n</h1>
        <input type="email" id="loginEmail" placeholder="Correo Electr√≥nico" required>
        <input type="password" id="loginPassword" placeholder="Contrase√±a" required>
        <button class="button" id="loginBtn">Iniciar sesi√≥n</button>
        <div class="switch-container">
            <p>¬øNo tienes cuenta? <a id="switchToRegister">Crear cuenta</a></p>
        </div>
    </div>

    <div class="loading-container" id="loading-screen">
        <div class="loader"></div>
        <p>Cargando...</p>
    </div>

<div class="menu-container" id="menu-screen">
    <h1>ACEITES Y LIPIDOS BD TE DA LA BIENVENIDA</h1>


    <div class="tabs">
    <div id="tab-home" class="active">Inicio</div>
    <div id="tab-lists">Listas</div>
    <div id="tab-files">Formatos </div>
    <div id="tab-requisitos">Requisitos</div>
    <div id="tab-mapa">Mapa de Procesos</div>
    <div id="tab-procedimientos">Procedimientos</div>
    <div id="tab-inocuidad">Pol√≠tica de Inocuidad</div>


</div>




    <!-- Contenido de Inicio -->
    <div id="home" class="tab-content active">
        <h2></h2>
        <p></p>
        <div class="info-container">
            <li>
                <p><strong>Objetivo:</strong><br>Evaluar la documentaci√≥n y el grado de implementaci√≥n del 
                    Sistema de An√°lisis de Peligros y Puntos Cr√≠ticos de Control
                    de la organizaci√≥n as√≠ como el cumplimiento 
                    de requisitos legales aplicables.</p>
            </li>
            <li>
                <p><strong>Alcance:</strong><br>
                    Formulaci√≥n de aceites vegetales
                    para la industria de alimentos, 
                    comercializaci√≥n de ingredientes para 
                    la industria de alimentos.</p>
            </li>
        </div>
        <!-- Bot√≥n para cargar el archivo HACCP -->
        <button id="btn-haccp" class="green-button">Manual HACCP</button>
<button id="btn-proceso" class="green-button">Procedimiento</button>
<button id="btn-calidad" class="green-button">Manual de Gesti√≥n de Calidad</button>


        
        <!-- Contenedor para mostrar el PDF -->
        <div id="pdf-container" style="display: none; margin-top: 20px;">
            <iframe id="pdf-viewer" style="width: 100%; height: 600px; border: none;"></iframe>
        </div>
    </div>

<div id="pdf-container-proceso" style="display: none; margin-top: 20px;">
    <iframe id="pdf-viewer-proceso" style="width: 100%; height: 600px; border: none;"></iframe>
</div>

    
<div id="pdf-container-calidad" style="display: none; margin-top: 20px;">
    <iframe id="pdf-viewer-calidad" style="width: 100%; height: 600px; border: none;"></iframe>
</div>

        

        <div id="lists" class="tab-content">
    <h2>Lista Maestra</h2>
    <div class="dropdown-menu" id="listsDropdownMenu" style="display: block;">
        <a href="#" onclick="showListContent('documentada')">Informaci√≥n Documentada Mantenida</a>
        <a href="#" onclick="showListContent('externos')">Documentos Externos</a>
        <a href="#" onclick="showListContent('registros')">Registros</a>
        <a href="#" onclick="showListContent('perfil')">Perfil Funcional</a>
        <a href="#" onclick="showListContent('responsabilidades')">Responsabilidades</a>
        <a href="#" onclick="showListContent('Procesos')">Procesos</a>
         <!-- Contenedor de paginaci√≥n -->
    </div>

    <div id="list-content">
        <table>
            <thead>
                <tr>
                    <th>T√≠tulo</th>
                    <th>C√≥digo</th>
                    <th>Archivo</th>
                </tr>
            </thead>
            <tbody id="fileTableBody-lists"></tbody>
        </table>
       
</div>
<!-- Contenedor de paginaci√≥n -->
       <div id="pagination-container-files" style="margin-top: 20px; text-align: center;"></div>
</div>


  <!-- Men√∫ de tres puntos -->
 <div class="three-dots-menu" id="threeDotsMenu">‚ãÆ</div>
    <div class="three-dots-dropdown" id="threeDotsDropdown" style="display: none;">
        <a href="#" id="nonConformities">No conformidades</a>
        <a href="#" id="directiveDecisions">Decisiones directivas</a>
        <a href="#" id="correctiveActions">Acciones correctivas</a>
        <a href="#" id="otherOptions">Otras Opciones</a> <!-- Nueva opci√≥n -->
    </div>

    
  <div id="files" class="tab-content">
            <h2>Formatos</h2>
            <input type="file" id="fileInput" />
            <button class="button" id="uploadBtn">Subir Formatos </button>
            
            <table>
                <thead>
                    <tr>
                        <th>T√≠tulo</th>
                        <th>C√≥digo</th>
                        <th>Formato</th>
                    </tr>
                </thead>
                <tbody id="fileTableBody">
                </tbody>
            </table>
  <!-- Contenedor de paginaci√≥n -->
    


     </div>

     <div id="requisitos" class="tab-content">
    <h2 style="color: #00b954; text-align: center;">Selecci√≥n de Requisitos</h2>
    <div class="tabs" style="justify-content: center;">
        <div id="req-tab-contexto" class="active">4. Contexto</div>
        <div id="req-tab-liderazgo">5. Liderazgo</div>
        <div id="req-tab-planificacion">6. Planificaci√≥n</div>
        <div id="req-tab-apoyo">7. Apoyo</div>
        <div id="req-tab-operacion">8. Operaci√≥n</div>
        <div id="req-tab-desempe√±o">9. Desempe√±o</div>
        <div id="req-tab-mejora">10. Mejora</div>
    </div>

    <div id="requisitos-content" class="requisitos-content" style="display: flex; flex-direction: column; align-items: center;">
        <!-- B√∫squeda -->
        <div id="search-bar" style="margin: 20px 0; text-align: center;">
            <input 
                type="text" 
                id="searchInput-requisitos" 
                placeholder="Buscar en los requisitos..." 
                style="padding: 10px; border-radius: 5px; border: 1px solid #ccc; width: 250px;"
            />
            <button id="searchButton-requisitos" class="green-button" style="margin-left: 10px;">Buscar</button>
        </div>

        <!-- Tabla -->
        <table style="width: 80%; border-collapse: collapse; margin: 20px 0; text-align: left;">
            <thead>
                <tr>
                    <th style="padding: 10px; background-color: #4b5e6e; color: white; border: 1px solid #ccc;">T√≠tulo</th>
                    <th style="padding: 10px; background-color: #4b5e6e; color: white; border: 1px solid #ccc;">C√≥digo</th>
                    <th style="padding: 10px; background-color: #4b5e6e; color: white; border: 1px solid #ccc;">Archivo</th>
                </tr>
            </thead>
            <tbody id="fileTableBody-requisitos">
                <!-- Los datos din√°micos aparecer√°n aqu√≠ -->
            </tbody>
        </table>

        <!-- Paginaci√≥n -->
        <div id="pagination-container-requisitos" style="margin-top: 20px; text-align: center;"></div>
    </div>
</div>

<div id="content-mapa" class="tab-content">
    <h2>Mapa de Procesos</h2>
    <img id="mapa-procesos-img" src="https://firebasestorage.googleapis.com/v0/b/plataforma-39bde.appspot.com/o/Imagen%20de%20WhatsApp%202024-12-11%20a%20las%2019.25.14_8d4d0dbe.jpg?alt=media&token=7e62d2be-5127-4b8f-a74d-eed009aefaef" alt="Mapa de Procesos">
   
</div>


<div id="procedimientos" class="tab-content">
    <h2>Procedimientos</h2>
    <input type="file" id="fileInput-procedimientos" />
    <button class="button" id="uploadBtn-procedimientos">Subir Procedimientos</button>
    
    <table>
        <thead>
            <tr>
                <th>T√≠tulo</th>
                <th>C√≥digo</th>
                <th>Archivo</th>
            </tr>
        </thead>
        <tbody id="fileTableBody-procedimientos">
            <!-- Los archivos se cargar√°n din√°micamente aqu√≠ -->
        </tbody>
    </table>

    <!-- Contenedor de paginaci√≥n -->
    <div id="pagination-container-procedimientos" style="margin-top: 20px; text-align: center;"></div>
</div>



<div id="inocuidad" class="tab-content">
    <h2>Pol√≠tica de Inocuidad</h2>
    <div class="reglamento-container" style="text-align: justify; padding: 20px;">
        <p>Es obligatorio para todo el personal que labora en las instalaciones de la organizaci√≥n, as√≠ como todas aquellas personas externas a la operaci√≥n que ingresen a estas cumplir con las normas de buenas pr√°cticas de manufactura establecidas en el presente reglamento antes de entrar al √°rea de proceso.</p>
        <ol>
            <li>Todo el personal debe de practicar los siguientes h√°bitos de higiene personal:
                <ul>
                    <li>‚àö Presentarse aseado a laborar (ba√±ado y con ropa limpia incluyendo la interior).</li>
                    <li>‚àö Los hombres deben traer el cabello corto y limpio, en caso de usar bigote este deber ser recortado a la comisura del labio superior.</li>
                    <li>‚àö Las barbas y/o vello facial largo, quedan estrictamente prohibidos para el personal.</li>
                    <li>‚àö Usar desodorante y talco.</li>
                    <li>‚àö Lavarse los dientes.</li>
                    <li>‚àö Rasurarse diariamente.</li>
                    <li>‚àö Las u√±as deber√°n usarse cortas, limpias y sin esmalte.</li>
                    <li>‚àö Se permite el uso de patillas siempre que est√©n recortadas y que no se extiendan m√°s all√° del l√≥bulo inferior de la oreja.</li>
                    <li>‚àö Prohibido el uso de maquillaje en √°reas operativas.</li>
                    <li>‚àö Portar uniforme limpio y completo, mismo que deber√° traerlo al centro de trabajo dentro de una bolsa pl√°stica limpia.</li>
                    <li>‚àö Solo se permite el uso de zapatos cerrados y de suela antideslizante; deber√°n mantenerse limpios y en buenas condiciones. El uso de tenis dentro del √°rea de proceso no est√° permitido.</li>
                </ul>
            </li>
            <li>Todo personal operativo no debe exhibir lesiones y/o infecciones en piel, gastrointestinales, garganta y o√≠dos y en caso de presentar alguna notificar al Titular del √°rea para que se tomen las medidas preventivas.</li>
            <li>Debe portar correctamente el uniforme designado a su √°rea.</li>
            <li>Utilizar √∫nicamente los materiales y/o uniformes asignados a su √°rea, en caso de requerir algo distinto debe consultar con el √°rea Titular de √°rea y/o Aseguramiento de Calidad.</li>
            <li>Prohibido el uso de joyas, pulseras, dijes, reloj, escapularios, piercings o adornos ya que estos se pueden desprender y caer en el producto.</li>
            <li>Prohibido alterar el uniforme, equipo de trabajo o seguridad, escribiendo sobre √©l o colocando calcoman√≠as, fuera de lo oficialmente designado.</li>
            <li>Todo el personal que ingrese a las √°reas operativas deber√° lavar y sanear las manos correctamente:
                <ul>
                    <li>‚àö Antes de iniciar labores.</li>
                    <li>‚àö Antes de manipular los productos.</li>
                    <li>‚àö Antes y despu√©s de comer.</li>
                    <li>‚àö Despu√©s de ir al servicio sanitario.</li>
                    <li>‚àö Despu√©s de toser, estornudar o tocarse la nariz.</li>
                    <li>‚àö Despu√©s de manipular residuos.</li>
                </ul>
            </li>
            <li>En las zonas donde se manipule productos est√° prohibido todo acto que pueda resultar en contaminaci√≥n de estos. El personal debe evitar pr√°cticas inadecuadas y antihigi√©nicas como rascarse la cabeza, tocarse la frente, introducir los dedos en las orejas, nariz y boca, entre otros.</li>
            <li>Prohibido sentarse en el piso con el uniforme puesto, aplica dentro y fuera de las instalaciones de la planta.</li>
            <li>Prohibido consumir alimentos, dulces, bebidas, mascar chicle, fumar o escupir dentro de √°reas operativas y solo ser√° permitido en las √°reas establecidas para tal fin.</li>
            <li>Todo personal que toque algo que cay√≥ o tuvo contacto con el piso debe lavarse las manos antes de continuar sus tareas.</li>
            <li>Prohibido colocar el producto y utensilios de trabajo en el piso.</li>
            <li>El personal s√≥lo se limitar√° a realizar sus actividades indicadas dentro de su √°rea, as√≠ como aquellas otras que le sea designadas por su competencia.</li>
            <li>En caso de que el producto que est√° siendo elaborado caiga al piso, inmediatamente debe desecharse.</li>
            <li>En caso de que cualquier utensilio que caiga al piso debe ser lavado y saneado nuevamente antes de ser usado.</li>
            <li>Debe respetarse lo documentado en los Procedimientos Operativos Estandarizados de Saneamiento (POES).</li>
            <li>No colocar utensilios de limpieza sobre equipos, zonas de contacto con el producto o sobre piso sucio.</li>
            <li>Se deben de guardar los materiales de limpieza, qu√≠micos y otras sustancias peligrosas en el lugar asignado, bajo llave y con acceso restringido.</li>
            <li>Deben lavarse todos los equipos, utensilios y accesorios empleados en la elaboraci√≥n de productos al finalizar su uso evitando dejar residuos.</li>
            <li>El personal debe separar o segregar el producto no conforme en el √°rea designada para esta actividad.</li>
            <li>El personal debe de seguir el Sistema de almacenamiento y rotaci√≥n de stock establecido primeras entradas-primeras salidas (PEPS).</li>
            <li>Todo personal que eval√∫e producto en proceso antes de que lo toque debe sanear sus manos para evitar contaminaci√≥n cruzada.</li>
            <li>Todo personal que realice actividades que afecten la calidad del producto y/o inocuidad de estos por ning√∫n motivo debe realizar actividades que pongan en riesgo la calidad e inocuidad del producto.</li>
            <li>Todo el personal que ingrese al √°rea de proceso deber√° cubrir su cabeza con una cofia. El cabello deber√° usarse de preferencia corto; aquellas personas con cabello largo deber√°n sujetarlo para que no salga de la cofia.</li>
            <li>Todo el personal que entre en contacto con producto o superficies en contacto con el alimento debe cubrirse la boca y la nariz con un cubrebocas o mascarilla.</li>
            <li>Los objetos personales y ropa deben guardarse √∫nicamente en casilleros asignados para ello.</li>
            <li>Todo el personal debe mantener aseado el lugar en que desempe√±an su trabajo, as√≠ como conservar en buen estado y operar los equipos y utensilios proporcionados.</li>
            <li>Todo el personal debe contribuir a contar con un ambiente laboral de cordialidad y respeto.</li>
            <li>Conducirse en el centro de trabajo en forma segura para evitar cualquier riesgo en su persona y/o en la inocuidad del producto.</li>
            <li>Someterse a los ex√°menes m√©dicos que establezca el √°rea de Recursos Humanos trat√°ndose de trabajadores que interact√∫an con alimentos.</li>
            <li>Participar en la capacitaci√≥n, adiestramiento y eventos de informaci√≥n que el √°rea de Recursos Humanos programe.</li>
            <li>Informar al Titular de Recursos Humanos sobre sus posibles limitaciones para realizar actividades.</li>
            <li>Avisar inmediatamente al Titular del √°rea y/o Aseguramiento de Calidad sobre condiciones inseguras o accidentes de trabajo.</li>
        </ol>
    </div>
</div>


  
    <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-storage.js";
// Configuraci√≥n de Firebase (aseg√∫rate de que ya tienes Firebase configurado)


const firebaseConfig = {
    apiKey: "AIzaSyD323PEVx7xnnBWpMr2usOEEFQQ20YUcD8",
    authDomain: "plataforma-39bde.firebaseapp.com",
    databaseURL: "https://plataforma-39bde-default-rtdb.firebaseio.com",
    projectId: "plataforma-39bde",
    storageBucket: "plataforma-39bde.appspot.com",
    messagingSenderId: "313253115880",
    appId: "1:313253115880:web:fcaf513b16c4f892ae965d",
    measurementId: "G-D959K30F9R"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);

// Configuraci√≥n para Alfa
const alfaAssistant = document.getElementById('alfaAssistant');
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
const recognition = new SpeechRecognition();
recognition.lang = 'es-ES';

let currentUserName = "";
let listening = false; // Controla si Alfa est√° escuchando
const synth = window.speechSynthesis; // S√≠ntesis de voz
let isSpeaking = false; // Controla si Alfa est√° hablando

// Funci√≥n para inicializar Alfa
async function initializeAlfa() {
    if (!auth.currentUser) {
        speak("Debes iniciar sesi√≥n para usar Alfa.");
        return;
    }

    // Obtener el nombre del usuario actual
    const userRef = doc(db, "users", auth.currentUser.uid);
    const userDoc = await getDoc(userRef);

    if (userDoc.exists()) {
        currentUserName = userDoc.data().nombre;
        speak(`Hola ${currentUserName}, soy Alfa. Estoy listo para ayudarte.`);
    } else {
        speak("No se encontraron datos del usuario.");
    }

    recognition.start(); // Iniciar el reconocimiento de voz
}

// Manejo de resultados de voz
recognition.onresult = (event) => {
    if (isSpeaking) return; // Evitar procesar comandos mientras Alfa est√° hablando

    const command = event.results[0][0].transcript.toLowerCase();
    handleCommand(command);
};

// Reiniciar reconocimiento cuando termina
recognition.onend = () => {
    if (listening) {
        recognition.start();
    }
};

// Manejar comandos de voz
function handleCommand(command) {
    if (command.includes('oye alfa')) {
        listening = true;
        speak(`Dime, ${currentUserName}.`);
    } else if (listening) {
        if (command.includes('abrir pesta√±a')) {
            handleTabCommand(command);
        } else if (command.includes('abrir archivo')) {
            handleFileCommand(command);
        } else if (command.includes('sube un archivo')) {
            handleUploadCommand(command);
        } else if (command.includes('ya es todo alfa') || command.includes('gracias alfa')) {
            listening = false;
            speak("Estoy a tus √≥rdenes.");
        } else {
            speak(`Lo siento ${currentUserName}, no entend√≠ tu solicitud.`);
        }
    }
}

// Manejar comandos para abrir pesta√±as
function handleTabCommand(command) {
    if (command.includes('listas')) {
        showTabContent('lists');
        speak("Abriendo la pesta√±a de listas.");
    } else if (command.includes('formatos')) {
        showTabContent('files');
        speak("Abriendo la pesta√±a de formatos.");
    } else if (command.includes('requisitos')) {
        showTabContent('requisitos');
        speak("Abriendo la pesta√±a de requisitos.");
    } else if (command.includes('inicio')) {
        showTabContent('home');
        speak("Abriendo la pesta√±a de inicio.");
    } else if (command.includes('mapa')) {
        showTabContent('content-mapa');
        loadMapaProcesos();
        speak("Abriendo el mapa de procesos.");
    } else if (command.includes('procedimientos')) {
        showTabContent('procedimientos');
        speak("Abriendo la pesta√±a de procedimientos.");
    } else if (command.includes('inocuidad')) {
        showTabContent('inocuidad');
        speak("Abriendo la pol√≠tica de inocuidad.");
    } else {
        speak(`Lo siento ${currentUserName}, no encontr√© esa pesta√±a.`);
    }
}

// Manejar comandos para abrir archivos
function handleFileCommand(command) {
    const archivoSolicitado = command.replace('abrir archivo', '').trim().toLowerCase();

    buscarArchivo(archivoSolicitado).then((archivo) => {
        if (archivo) {
            window.open(archivo.url, '_blank');
            speak(`Abriendo el archivo ${archivo.name}.`);
        } else {
            speak(`No encontr√© un archivo llamado "${archivoSolicitado}".`);
        }
    });
}

// Manejar comandos para subir archivos
function handleUploadCommand(command) {
    const parts = command.replace('sube un archivo', '').trim().split('en la pesta√±a');
    if (parts.length < 2) {
        speak("Por favor, indica el nombre del archivo y la pesta√±a donde debo subirlo.");
        return;
    }

    const archivoSolicitado = parts[0].trim().toLowerCase();
    const pesta√±aDestino = parts[1].trim().toLowerCase();

    buscarArchivo(archivoSolicitado).then((archivos) => {
        if (archivos.length === 0) {
            speak(`No encontr√© ning√∫n archivo llamado "${archivoSolicitado}".`);
        } else if (archivos.length === 1) {
            subirArchivoAPesta√±a(archivos[0], pesta√±aDestino);
        } else {
            speak("Hay m√°s de un archivo con ese nombre. ¬øPuedes ser m√°s espec√≠fico?");
        }
    });
}

// Subir archivo a una pesta√±a espec√≠fica
async function subirArchivoAPesta√±a(archivo, pesta√±aDestino) {
    const collectionName = getCollectionNameFromTab(pesta√±aDestino);
    if (!collectionName) {
        speak(`No reconozco la pesta√±a "${pesta√±aDestino}".`);
        return;
    }

    try {
        await addDoc(collection(db, collectionName), {
            name: archivo.name,
            url: archivo.url,
            code: archivo.code || "C√≥digo no especificado",
            date: new Date().toLocaleDateString()
        });
        speak(`Archivo "${archivo.name}" subido a la pesta√±a "${pesta√±aDestino}".`);
    } catch (error) {
        console.error("Error al subir el archivo:", error);
        speak("Hubo un error al intentar subir el archivo.");
    }
}

// Buscar un archivo en Firestore por nombre
async function buscarArchivo(nombreArchivo) {
    try {
        const querySnapshot = await getDocs(collection(db, 'files'));
        const archivos = [];
        querySnapshot.forEach((doc) => {
            const archivo = doc.data();
            if (archivo.name.toLowerCase().includes(nombreArchivo)) {
                archivos.push(archivo);
            }
        });
        return archivos;
    } catch (error) {
        console.error('Error al buscar el archivo:', error);
    }
    return [];
}

// Obtener el nombre de la colecci√≥n Firestore seg√∫n la pesta√±a
function getCollectionNameFromTab(tabName) {
    switch (tabName) {
        case 'listas': return 'files-lists';
        case 'formatos': return 'files-formats';
        case 'requisitos': return 'files-requisitos';
        case 'procedimientos': return 'files-procedimientos';
        default: return null;
    }
}

// Mostrar el contenido de una pesta√±a
function showTabContent(tabId) {
    const tabContents = document.querySelectorAll('.tab-content'); // Contenido de todas las pesta√±as
    const tabs = document.querySelectorAll('.tabs div'); // Botones de todas las pesta√±as

    // Ocultar todas las pesta√±as y desactivar sus botones
    tabContents.forEach((content) => {
        content.classList.remove('active');
        content.style.display = 'none'; // Asegurar que no queden visibles
    });

    tabs.forEach((tab) => {
        tab.classList.remove('active');
    });

    // Mostrar la pesta√±a seleccionada
    const activeContent = document.getElementById(tabId);
    const activeTab = document.getElementById(`tab-${tabId}`);

    if (activeContent) {
        activeContent.classList.add('active');
        activeContent.style.display = 'block'; // Asegurar que se muestre correctamente
    } else {
        console.error(`No se encontr√≥ el contenido de la pesta√±a con ID: ${tabId}`);
    }

    if (activeTab) {
        activeTab.classList.add('active');
    } else {
        console.error(`No se encontr√≥ el bot√≥n de la pesta√±a con ID: tab-${tabId}`);
    }
}

// Funci√≥n para cargar el mapa de procesos
function loadMapaProcesos() {
    const imgMapaProcesos = document.getElementById("mapa-procesos-img");
    if (!imgMapaProcesos) {
        console.error("No se encontr√≥ el elemento de imagen para el mapa.");
        return;
    }

    const storageRef = ref(storage, 'path/to/your/image.jpg');
    getDownloadURL(storageRef)
        .then((url) => {
            imgMapaProcesos.src = url;
            imgMapaProcesos.style.display = 'block';
        })
        .catch((error) => {
            console.error("Error al cargar el mapa de procesos:", error);
        });
}

// Funci√≥n para que Alfa hable
function speak(text) {
    isSpeaking = true;
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'es-ES';

    utterance.onend = () => {
        isSpeaking = false;
    };

    synth.speak(utterance);
}

// Evento para activar Alfa al presionar el bot√≥n
alfaAssistant.addEventListener('click', () => {
    listening = true; // Activar escucha
    initializeAlfa();
});




// MAPA DE PROCESOS - C√≥digo actualizado para centrar la visualizaci√≥n

// MAPA DE PROCESOS - Mostrar solo cuando se est√° en la pesta√±a espec√≠fica
document.addEventListener('DOMContentLoaded', () => {
    const tabs = document.querySelectorAll('.tabs div');
    const contentMapa = document.getElementById('content-mapa');
    const imgMapaProcesos = document.getElementById('mapa-procesos-img');

    if (!contentMapa || !imgMapaProcesos) {
        console.error("No se encontraron los elementos necesarios para el mapa de procesos.");
        return;
    }

    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            // Ocultar el contenido del mapa al cambiar de pesta√±a
            if (tab.id !== 'tab-mapa') {
                contentMapa.style.display = 'none';
                imgMapaProcesos.src = ''; // Limpiar la imagen
            } else {
                // Mostrar el contenido del mapa al entrar en la pesta√±a "Mapa de Procesos"
                contentMapa.style.display = 'flex';
                contentMapa.style.flexDirection = 'column';
                contentMapa.style.justifyContent = 'center';
                contentMapa.style.alignItems = 'center';
                contentMapa.style.height = '100vh';
                contentMapa.style.backgroundColor = '#f8f8f8';

                // Cargar la imagen desde Firebase Storage
                const storage = getStorage();
                const imageRef = ref(storage, 'Imagen de WhatsApp 2024-12-11 a las 19.25.14_8d4d0dbe.jpg');

                getDownloadURL(imageRef)
                    .then((url) => {
                        imgMapaProcesos.src = url;
                        imgMapaProcesos.style.maxWidth = '90%';
                        imgMapaProcesos.style.height = 'auto';
                        imgMapaProcesos.style.border = '2px solid #ddd';
                        imgMapaProcesos.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.1)';
                    })
                    .catch((error) => {
                        console.error('Error al cargar la imagen:', error);
                        imgMapaProcesos.alt = 'Error al cargar el mapa de procesos.';
                    });
            }
        });
    });
});




// Variables globales
let pdfDocument = null; // Documento PDF cargado
let currentPage = 1; // P√°gina actual
let currentMatches = []; // Coincidencias actuales
let currentMatchIndex = -1; // √çndice de la coincidencia actual
const pdfViewerContainer = document.getElementById("pdfViewerContainer");



//FUN CION PARA PESTA√ëA DE DOCUMENTOS 
// Variables para la paginaci√≥n
let currentPageFiles = 1;
let currentPageLists = 1;
const itemsPerPage = 5;

// Funci√≥n para cargar los archivos con paginaci√≥n
async function loadFilesPaginated() {
    const fileTableBody = document.getElementById("fileTableBody");
    const paginationContainer = document.getElementById("pagination-container-files");
    fileTableBody.innerHTML = "";
    paginationContainer.innerHTML = "";

    // Obtener todos los archivos desde Firestore
    const querySnapshot = await getDocs(collection(db, "files"));
    const files = [];
    querySnapshot.forEach((doc) => {
        files.push(doc.data());
    });

    // Ordenar los archivos por nombre para consistencia
    files.sort((a, b) => a.name.localeCompare(b.name));

    // Calcular el n√∫mero total de p√°ginas
    const totalPages = Math.ceil(files.length / itemsPerPage);

    // Validar que la p√°gina actual no exceda el total de p√°ginas
    if (currentPageFiles > totalPages) {
        currentPageFiles = totalPages;
    }

    // Obtener los archivos de la p√°gina actual
    const start = (currentPageFiles - 1) * itemsPerPage;
    const end = start + itemsPerPage;
    const currentFiles = files.slice(start, end);

    // Mostrar los archivos en la tabla
    currentFiles.forEach((fileData) => {
        const row = document.createElement("tr");

        const titleCell = document.createElement("td");
        titleCell.textContent = fileData.name;

        const codeCell = document.createElement("td");
        codeCell.textContent = fileData.code || "C√≥digo no encontrado";

        const fileCell = document.createElement("td");
        if (fileData.url) {
            const link = document.createElement("a");
            link.href = fileData.url;
            link.target = "_blank";
            link.classList.add("file-link");
            link.innerHTML = `<img src="https://img.icons8.com/ios-filled/50/000000/pdf.png" class="icon" /> Ver archivo`;
            fileCell.appendChild(link);
        } else {
            fileCell.textContent = "Sin Archivo";
            fileCell.classList.add("no-file");
        }

        row.appendChild(titleCell);
        row.appendChild(codeCell);
        row.appendChild(fileCell);
        fileTableBody.appendChild(row);
    });

    // Crear botones de paginaci√≥n
    for (let i = 1; i <= totalPages; i++) {
        const button = document.createElement("button");
        button.textContent = i;
        button.classList.add("pagination-button");
        if (i === currentPageFiles) button.classList.add("active");
        button.addEventListener("click", () => {
            currentPageFiles = i;
            loadFilesPaginated();
        });
        paginationContainer.appendChild(button);
    }
}

// Funci√≥n para cargar las listas con paginaci√≥n
async function loadListsPaginated(type) {
    const fileTableBody = document.getElementById("fileTableBody-lists");
    const paginationContainer = document.getElementById("pagination-container-files");
    fileTableBody.innerHTML = "";
    paginationContainer.innerHTML = "";

    // Obtener todos los documentos del tipo especificado
    const querySnapshot = await getDocs(collection(db, `files-${type}`));
    const files = [];
    querySnapshot.forEach((doc) => {
        files.push(doc.data());
    });

    // Ordenar los archivos por nombre para consistencia
    files.sort((a, b) => a.name.localeCompare(b.name));

    // Calcular el n√∫mero total de p√°ginas
    const totalPages = Math.ceil(files.length / itemsPerPage);

    // Validar que la p√°gina actual no exceda el total de p√°ginas
    if (currentPageLists > totalPages) {
        currentPageLists = totalPages;
    }

    // Obtener los formatos de la p√°gina actual
    const start = (currentPageLists - 1) * itemsPerPage;
    const end = start + itemsPerPage;
    const currentFiles = files.slice(start, end);

    // Mostrar los formatos en la tabla
    currentFiles.forEach((fileData) => {
        const row = document.createElement("tr");

        const titleCell = document.createElement("td");
        titleCell.textContent = fileData.name;

        const codeCell = document.createElement("td");
        codeCell.textContent = fileData.code || "C√≥digo no encontrado";

        const fileCell = document.createElement("td");
        if (fileData.url) {
            const link = document.createElement("a");
            link.href = fileData.url;
            link.target = "_blank";
            link.classList.add("file-link");
            link.innerHTML = `<img src="https://img.icons8.com/ios-filled/50/000000/pdf.png" class="icon" /> Ver archivo`;
            fileCell.appendChild(link);
        } else {
            fileCell.textContent = "Sin Archivo";
            fileCell.classList.add("no-file");
        }

        row.appendChild(titleCell);
        row.appendChild(codeCell);
        row.appendChild(fileCell);
        fileTableBody.appendChild(row);
    });

    // Crear botones de paginaci√≥n
    for (let i = 1; i <= totalPages; i++) {
        const button = document.createElement("button");
        button.textContent = i;
        button.classList.add("pagination-button");
        if (i === currentPageLists) button.classList.add("active");
        button.addEventListener("click", () => {
            currentPageLists = i;
            loadListsPaginated(type);
        });
        paginationContainer.appendChild(button);
    }
}

// Llamar a las funciones de paginaci√≥n
loadFilesPaginated();

// Mostrar contenido basado en la categor√≠a seleccionada
window.showListContent = function(type) {
    currentPageLists = 1; // Reiniciar la p√°gina al cambiar de lista
    loadListsPaginated(type);
};








// Archivos de PDF en Firebase Storage
const pdfFiles = {
    iso9001: "normas/NORMA_ISO_9001-2015_Req.PDF",
    iso22000: "normas/ISO-22000-2018.pdf",
};

// Obtener la URL del PDF desde Firebase Storage
async function getPdfUrl(filePath) {
    const fileRef = ref(storage, filePath);
    try {
        const url = await getDownloadURL(fileRef);
        return url;
    } catch (error) {
        console.error(`Error al obtener la URL de ${filePath}:`, error);
        alert("No se pudo cargar el archivo PDF. Intenta de nuevo m√°s tarde.");
        return null;
    }
}

// Renderizar una p√°gina en un canvas
async function renderPage(pageNumber, searchTerm = null) {
    const page = await pdfDocument.getPage(pageNumber);
    const viewport = page.getViewport({ scale: 1.5 });

    // Crear canvas para la p√°gina
    const canvas = document.createElement("canvas");
    const context = canvas.getContext("2d");
    canvas.width = viewport.width;
    canvas.height = viewport.height;
    canvas.style.marginBottom = "20px";

    // Renderizar el PDF en el canvas
    const renderContext = {
        canvasContext: context,
        viewport: viewport,
    };
    await page.render(renderContext).promise;

    // Agregar el canvas al contenedor
    pdfViewerContainer.appendChild(canvas);

    // Si hay un t√©rmino de b√∫squeda, subrayar coincidencias
    if (searchTerm) {
        return underlineFullWords(page, viewport, searchTerm, context, pageNumber);
    }

    return [];
}

// Subrayar texto coincidente en la p√°gina
async function underlineFullWords(page, viewport, searchTerm, context, pageNumber) {
    const textContent = await page.getTextContent();
    const scale = viewport.scale;
    const matches = [];

    textContent.items.forEach((item) => {
        const text = item.str;

        if (text.toLowerCase().includes(searchTerm.toLowerCase())) {
            // Posici√≥n y dimensiones del texto
            const transform = item.transform;
            const x = transform[4]; // Posici√≥n X
            const y = transform[5]; // Posici√≥n Y
            const width = context.measureText(text).width * scale; // Ancho de la palabra completa
            const height = item.height * scale; // Altura de la palabra

            // Dibujar un rect√°ngulo amarillo debajo de la palabra coincidente
            context.fillStyle = "rgba(255, 255, 0, 0.6)";
            context.fillRect(x * scale, viewport.height - y * scale - height, width, height);

            // Guardar la posici√≥n de la coincidencia
            matches.push({ page: pageNumber, x: x * scale, y: viewport.height - y * scale, width, height });
        }
    });

    return matches;
}

// Cargar el PDF y renderizar sus p√°ginas
async function loadPdfAndInitializeViewer(norma) {
    const filePath = pdfFiles[norma];
    if (filePath) {
        const pdfUrl = await getPdfUrl(filePath);
        if (pdfUrl) {
            pdfViewerContainer.innerHTML = ""; // Limpiar contenedor
            pdfDocument = await pdfjsLib.getDocument(pdfUrl).promise;

            // Renderizar todas las p√°ginas
            for (let i = 1; i <= pdfDocument.numPages; i++) {
                await renderPage(i);
            }
           
        } else {
            alert("Error al cargar el archivo seleccionado.");
        }
    } else {
        alert("No se encontr√≥ el archivo para la norma seleccionada.");
    }
}

// Ejecutar la b√∫squeda y subrayar las coincidencias
const searchButton = document.getElementById("searchButton");
const searchInput = document.getElementById("searchInput");
const prevMatchButton = document.getElementById("prevMatchButton");
const nextMatchButton = document.getElementById("nextMatchButton");

searchButton.addEventListener("click", async () => {
    const searchTerm = searchInput.value.trim();
    if (!searchTerm) {
        alert("Ingresa una palabra para buscar.");
        return;
    }

    if (!pdfDocument) {
        alert("Primero debes cargar un documento.");
        return;
    }

    // Volver a renderizar las p√°ginas con subrayado y obtener coincidencias
    pdfViewerContainer.innerHTML = ""; // Limpiar contenedor
    currentMatches = []; // Reiniciar coincidencias
    for (let i = 1; i <= pdfDocument.numPages; i++) {
        const matches = await renderPage(i, searchTerm);
        currentMatches = currentMatches.concat(matches);
    }

    if (currentMatches.length > 0) {
        alert(`Se encontraron ${currentMatches.length} coincidencias.`);
        currentMatchIndex = 0;
        goToMatch(currentMatchIndex);
    } else {
        alert("No se encontraron coincidencias.");
    }
});

// Navegar a una coincidencia espec√≠fica
function goToMatch(index) {
    const match = currentMatches[index];
    if (!match) return;

    // Cambiar a la p√°gina de la coincidencia
    pdfViewerContainer.innerHTML = ""; // Limpiar contenedor
    renderPage(match.page).then(() => {
        const canvas = pdfViewerContainer.querySelector("canvas");
        const context = canvas.getContext("2d");

        // Resaltar la coincidencia actual
        context.strokeStyle = "red";
        context.lineWidth = 2;
        context.strokeRect(match.x, match.y - match.height, match.width, match.height);
    });
}

// Bot√≥n "Anterior"
prevMatchButton.addEventListener("click", () => {
    if (currentMatches.length === 0) return;
    currentMatchIndex = (currentMatchIndex - 1 + currentMatches.length) % currentMatches.length;
    goToMatch(currentMatchIndex);
});

// Bot√≥n "Siguiente"
nextMatchButton.addEventListener("click", () => {
    if (currentMatches.length === 0) return;
    currentMatchIndex = (currentMatchIndex + 1) % currentMatches.length;
    goToMatch(currentMatchIndex);
});

// Cargar el PDF inicial (por defecto ISO 9001)
loadPdfAndInitializeViewer("iso9001");


// Cambiar PDF seg√∫n la norma seleccionada
if (normasSelector) {
    normasSelector.addEventListener("change", (e) => {
        const norma = e.target.value;
        loadPdfAndInitializeViewer(norma);
    });
}

// Abrir modal de Normas ISO
if (normasIsoButton) {
    normasIsoButton.addEventListener("click", () => {
        pdfModal.style.display = "flex";
        loadPdfAndInitializeViewer("iso9001"); // Cargar ISO 9001 por defecto
    });
}



// Obtener el modal y el bot√≥n de cerrar
const pdfModal = document.getElementById("pdfModal");
const closePdfModal = document.getElementById("closePdfModal");

// Funci√≥n para cerrar el modal
function closeModal() {
    pdfModal.style.display = "none";
}



// Cerrar el modal al hacer clic en la X
closePdfModal.addEventListener("click", closeModal);

// Cerrar el modal al hacer clic fuera del contenido
window.addEventListener("click", (event) => {
    if (event.target === pdfModal) {
        closeModal();
    }
});








        async function loadOrgChartImage() {
            const storageRef = ref(storage, 'OrganigramaDiciembre2024.pdf');
            const url = await getDownloadURL(storageRef);
            document.querySelector("#orgChartModal img").src = url;
        }

        document.getElementById("openOrgChart").addEventListener("click", () => {
            loadOrgChartImage();
            document.getElementById("orgChartModal").style.display = "block";
        });

        document.getElementById("closeOrgChart").addEventListener("click", () => {
            document.getElementById("orgChartModal").style.display = "none";
        });

        window.addEventListener("click", (event) => {
            if (event.target == document.getElementById("orgChartModal")) {
                document.getElementById("orgChartModal").style.display = "none";
            }
        });

        document.getElementById("user-box").addEventListener("click", () => {
            const dropdownMenu = document.getElementById("dropdown-menu");
            dropdownMenu.style.display = dropdownMenu.style.display === "block" ? "none" : "block";
        });

        window.addEventListener("click", (event) => {
            if (!event.target.matches("#user-box")) {
                document.getElementById("dropdown-menu").style.display = "none";
            }
        });

        async function extractCodeFromPDF(file) {
            const fileReader = new FileReader();
            return new Promise((resolve, reject) => {
                fileReader.onload = async function () {
                    const typedarray = new Uint8Array(this.result);
                    const pdf = await pdfjsLib.getDocument(typedarray).promise;
                    let extractedText = '';
                    for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                        const page = await pdf.getPage(pageNum);
                        const textContent = await page.getTextContent();
                        textContent.items.forEach((item) => {
                            extractedText += item.str + ' ';
                        });
                    }
                    const codeMatch = extractedText.match(/REG-\d{4}-\d{2}/);
                    resolve(codeMatch ? codeMatch[0] : "C√≥digo no encontrado");
                };
                fileReader.onerror = () => reject("Error al leer el PDF");
                fileReader.readAsArrayBuffer(file);
            });
        }

        document.getElementById('registerBtn').addEventListener('click', async () => {
            const nombre = document.getElementById('nombre').value;
            const apellido = document.getElementById('apellido').value;
            const rol = document.getElementById('rol').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            if (!nombre || !apellido || !rol || !email || !password) {
                alert('Por favor complete todos los campos.');
                return;
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                await setDoc(doc(db, "users", user.uid), {
                    nombre: nombre,
                    apellido: apellido,
                    rol: rol,
                    email: email
                });

                showLoadingScreen();
            } catch (error) {
                console.error('Error al registrar usuario:', error.message);
                alert('Error al registrar usuario: ' + error.message);
            }
        });

        document.getElementById('loginBtn').addEventListener('click', async () => {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                alert('Por favor ingrese su correo electr√≥nico y contrase√±a.');
                return;
            }

            try {
                await signInWithEmailAndPassword(auth, email, password);
                showLoadingScreen();
            } catch (error) {
                console.error('Error al iniciar sesi√≥n:', error.message);
                alert('Error al iniciar sesi√≥n: ' + error.message);
            }
        });

        function showLoadingScreen() {
            document.getElementById('register-screen').style.display = 'none';
            document.getElementById('signin-screen').style.display = 'none';
            document.getElementById('info-container').style.display = 'none';
            document.getElementById('loading-screen').style.display = 'flex';

            setTimeout(() => {
                document.getElementById('loading-screen').style.display = 'none';
                document.getElementById('menu-screen').style.display = 'block';
                loadFiles();
            }, 5000);
        }

        document.getElementById('switchToSignIn').addEventListener('click', () => {
            document.getElementById('register-screen').style.display = 'none';
            document.getElementById('signin-screen').style.display = 'block';
        });

        document.getElementById('switchToRegister').addEventListener('click', () => {
            document.getElementById('signin-screen').style.display = 'none';
            document.getElementById('register-screen').style.display = 'block';
        });

        document.getElementById('uploadBtn').addEventListener('click', async () => {
            const fileInput = document.getElementById("fileInput");
            const file = fileInput.files[0];

            if (!file) {
                alert("Por favor seleccione un archivo para subir.");
                return;
            }

            const code = await extractCodeFromPDF(file);

            try {
                const fileName = file.name;
                const storageRef = ref(storage, `uploads/${fileName}`);
                await uploadBytes(storageRef, file);
                const downloadURL = await getDownloadURL(storageRef);

                await addDoc(collection(db, "files"), {
                    name: fileName,
                    url: downloadURL,
                    code: code,
                    date: new Date().toLocaleDateString()
                });

                loadFiles();
                fileInput.value = "";
            } catch (error) {
                console.error("Error al subir el archivo:", error.message);
                alert("Error al subir el archivo: " + error.message);
            }
        });

        async function loadFiles() {
            const fileTableBody = document.getElementById("fileTableBody");
            fileTableBody.innerHTML = '';
            const querySnapshot = await getDocs(collection(db, "files"));

            querySnapshot.forEach((doc) => {
                const fileData = doc.data();
                const row = document.createElement("tr");

                const titleCell = document.createElement("td");
                titleCell.textContent = fileData.name;

                const codeCell = document.createElement("td");
                codeCell.textContent = fileData.code || "C√≥digo no encontrado";

                const fileCell = document.createElement("td");
                if (fileData.url) {
                    const link = document.createElement("a");
                    link.href = fileData.url;
                    link.target = "_blank";
                    link.classList.add("file-link");
                    link.innerHTML = `<img src="https://img.icons8.com/ios-filled/50/000000/pdf.png" class="icon" /> Ver archivo`;
                    fileCell.appendChild(link);
                } else {
                    fileCell.textContent = "Sin Archivo";
                    fileCell.classList.add("no-file");
                }

                row.appendChild(titleCell);
                row.appendChild(codeCell);
                row.appendChild(fileCell);
                fileTableBody.appendChild(row);
            });
        }

        window.showListContent = function(type) {
            const listContent = document.getElementById("list-content");
            listContent.innerHTML = `
                <h3>${getListTitle(type)}</h3>
                <input type="file" id="fileInput-${type}" />
                <button class="button" onclick="uploadListFile('${type}')">Subir archivo</button>
                
                <table>
                    <thead>
                        <tr>
                            <th>T√≠tulo</th>
                            <th>C√≥digo</th>
                            <th>Archivo</th>
                        </tr>
                    </thead>
                    <tbody id="fileTableBody-${type}">
                    </tbody>
                </table>
            `;
            loadListFiles(type);
        };

        function getListTitle(type) {
            switch (type) {
                case 'documentada': return 'Informaci√≥n Documentada Mantenida';
                case 'externos': return 'Documentos Externos';
                case 'registros': return 'Registros';
                case 'perfil': return 'Perfil Funcional';
                case 'responsabilidades': return 'Responsabilidades';
                case 'Procesos': return 'Procesos';
                default: return 'Lista';
            }
        }

        // Define la funci√≥n como global para resolver el error de referencia
        window.uploadListFile = async function(type) {
            const fileInput = document.getElementById(`fileInput-${type}`);
            const file = fileInput.files[0];

            if (!file) {
                alert("Por favor seleccione un archivo para subir.");
                return;
            }

            const code = await extractCodeFromPDF(file);

            try {
                const fileName = file.name;
                const storageRef = ref(storage, `uploads/${type}/${fileName}`);
                await uploadBytes(storageRef, file);
                const downloadURL = await getDownloadURL(storageRef);

                await addDoc(collection(db, `files-${type}`), {
                    name: fileName,
                    url: downloadURL,
                    code: code,
                    date: new Date().toLocaleDateString()
                });

                loadListFiles(type);
                fileInput.value = "";
            } catch (error) {
                console.error("Error al subir el archivo:", error.message);
                alert("Error al subir el archivo: " + error.message);
            }
        };

        async function loadListFiles(type) {
            const fileTableBody = document.getElementById(`fileTableBody-${type}`);
            fileTableBody.innerHTML = '';
            const querySnapshot = await getDocs(collection(db, `files-${type}`));

            querySnapshot.forEach((doc) => {
                const fileData = doc.data();
                const row = document.createElement("tr");

                const titleCell = document.createElement("td");
                titleCell.textContent = fileData.name;

                const codeCell = document.createElement("td");
                codeCell.textContent = fileData.code || "C√≥digo no encontrado";

                const fileCell = document.createElement("td");
                if (fileData.url) {
                    const link = document.createElement("a");
                    link.href = fileData.url;
                    link.target = "_blank";
                    link.classList.add("file-link");
                    link.innerHTML = `<img src="https://img.icons8.com/ios-filled/50/000000/pdf.png" class="icon" /> Ver archivo`;
                    fileCell.appendChild(link);
                } else {
                    fileCell.textContent = "Sin Archivo";
                    fileCell.classList.add("no-file");
                }

                row.appendChild(titleCell);
                row.appendChild(codeCell);
                row.appendChild(fileCell);
                fileTableBody.appendChild(row);
            });
        }

        document.getElementById('tab-home').addEventListener('click', () => {
            showTabContent('home');
        });

        document.getElementById('tab-lists').addEventListener('click', () => {
            showTabContent('lists');
        });

        document.getElementById('tab-files').addEventListener('click', () => {
            showTabContent('files');
        });
document.getElementById('tab-requisitos').addEventListener('click', () => {
    showTabContent('requisitos');

        });

        

        loadFiles();

       document.getElementById("logout").addEventListener("click", () => {
    signOut(auth).then(() => {
        alert("Confirma cerrar sesi√≥n.");
        // Cambiar redirecci√≥n a la pantalla de creaci√≥n de cuenta e inicio de sesi√≥n
        document.getElementById('menu-screen').style.display = 'none';
        document.getElementById('signin-screen').style.display = 'block';
         document.getElementById('info-container').style.display = 'block';
    }).catch((error) => {
        console.error("Error al cerrar sesi√≥n:", error);
    });
});

// Funci√≥n para cargar los datos del perfil del usuario
async function loadUserProfile() {
    const user = auth.currentUser;

    if (user) {
        const userRef = doc(db, "users", user.uid); // Aseg√∫rate de que los datos del usuario est√©n en la colecci√≥n "users"
        const userDoc = await getDoc(userRef);

        if (userDoc.exists()) {
            const userData = userDoc.data();
            document.getElementById("userName").textContent = userData.nombre;
            document.getElementById("userLastName").textContent = userData.apellido;
            document.getElementById("userRole").textContent = userData.rol;
            document.getElementById("userEmail").textContent = userData.email;

            document.getElementById("profileModal").style.display = "block";
        } else {
            alert("No se encontraron datos del usuario.");
        }
    } else {
        alert("No se ha iniciado sesi√≥n.");
    }
}

// Mostrar modal de perfil al hacer clic en "Ver mi perfil"
document.getElementById("viewProfile").addEventListener("click", loadUserProfile);

// Cerrar modal de perfil
document.getElementById("closeProfile").addEventListener("click", () => {
    document.getElementById("profileModal").style.display = "none";
});

// Cerrar modal al hacer clic fuera de √©l
window.addEventListener("click", (event) => {
    if (event.target == document.getElementById("profileModal")) {
        document.getElementById("profileModal").style.display = "none";
    }
});
   // Funcionalidad para el men√∫ de tres puntos
     document.addEventListener("DOMContentLoaded", () => {
    const threeDotsMenu = document.getElementById("threeDotsMenu");
    const threeDotsDropdown = document.getElementById("threeDotsDropdown");

    // Mostrar/ocultar el men√∫ de tres puntos
    threeDotsMenu.addEventListener("click", (event) => {
        event.stopPropagation();
        const isVisible = threeDotsDropdown.style.display === "block";
        threeDotsDropdown.style.display = isVisible ? "none" : "block";
    });

    // Cerrar el men√∫ al hacer clic fuera
    window.addEventListener("click", () => {
        if (threeDotsDropdown.style.display === "block") {
            threeDotsDropdown.style.display = "none";
        }
    });

    // Funci√≥n para abrir un modal
    const createModal = (title, content) => {
        const modal = `
            <div class="modal" id="dynamicModal" style="display: flex;">
                <div class="modal-content">
                    <span class="close" id="closeModal">&times;</span>
                    <h2>${title}</h2>
                    <ul>${content}</ul>
                </div>
            </div>
        `;
        document.body.insertAdjacentHTML("beforeend", modal);

        // Cerrar el modal
        document.getElementById("closeModal").addEventListener("click", () => {
            document.getElementById("dynamicModal").remove();
        });

        // Cerrar el modal al hacer clic fuera de √©l
        window.addEventListener("click", (event) => {
            const modalElement = document.getElementById("dynamicModal");
            if (event.target === modalElement) {
                modalElement.remove();
            }
        });
    };

    // Configuraci√≥n para cada enlace del men√∫
    document.getElementById("nonConformities").addEventListener("click", (event) => {
        event.preventDefault();
        createModal("No Conformidades", `
            <li><a href="https://ctalexander.github.io/no-conformidades-/" target="_blank">Ir a No Conformidades</a></li>
        `);
    });

    document.getElementById("directiveDecisions").addEventListener("click", (event) => {
        event.preventDefault();
        createModal("Decisiones Directivas", `
            <li><a href="https://ctalexander.github.io/directive-decisions/" target="_blank">Ir a Decisiones Directivas</a></li>
        `);
    });

    document.getElementById("correctiveActions").addEventListener("click", (event) => {
        event.preventDefault();
        createModal("Acciones Correctivas", `
            <li><a href="https://ctalexander.github.io/corrective-actions/" target="_blank">Ir a Acciones Correctivas</a></li>
        `);
    });

    document.getElementById("otherOptions").addEventListener("click", (event) => {
        event.preventDefault();
        createModal("Otras Opciones", `
            <li><a href="https://ctalexander.github.io/entradas_y_salidas_2.0/" target="_blank">Entradas y Salidas</a></li>
            <li><a href="https://ctalexander.github.io/inventario-de-mps-/" target="_blank">Inventario de Materias Primas</a></li>
        `);
    });
});


   //HACCP
   // Manejar el clic del bot√≥n
document.getElementById("btn-haccp").addEventListener("click", () => {
    // Referencia al archivo en Firebase Storage
    const fileRef = ref(storage, "Plan de An√°lisis de Peligros y Puntos Cr√≠ticos de Control (HACCP) OK.pdf");

    // Obt√©n la URL de descarga
    getDownloadURL(fileRef)
        .then((url) => {
            // Muestra el contenedor del PDF
            const pdfContainer = document.getElementById("pdf-container");
            pdfContainer.style.display = "block";

            // Establece la URL del PDF en el iframe
            const pdfViewer = document.getElementById("pdf-viewer");
            pdfViewer.src = url;
        })
        .catch((error) => {
            console.error("Error al obtener el archivo:", error);
   });
});


document.getElementById("btn-haccp").addEventListener("click", (event) => {
    event.stopPropagation(); // Previene que el clic cierre el contenedor
    // Resto del c√≥digo para mostrar el PDF

    // Selecciona el contenedor y el bot√≥n
const pdfContainer = document.getElementById("pdf-container");
const pdfViewer = document.getElementById("pdf-viewer");

// Funci√≥n para cerrar el contenedor al hacer clic fuera de √©l
document.addEventListener("click", (event) => {
    // Verifica si el clic ocurri√≥ fuera del contenedor del PDF
    if (
        pdfContainer.style.display === "block" && // Solo si el contenedor est√° visible
        !pdfContainer.contains(event.target) // Si el clic no es dentro del contenedor
    ) {
        pdfContainer.style.display = "none"; // Oculta el contenedor
        pdfViewer.src = ""; // Limpia el contenido del iframe
    }
});

});


// Manejar el clic del bot√≥n Proceso
document.getElementById("btn-proceso").addEventListener("click", () => {
    // Referencia al archivo en Firebase Storage
    const fileRef = ref(storage, "Acciones para abordar riesgos y oportunidades y rev dir.pdf");

    // Obt√©n la URL de descarga
    getDownloadURL(fileRef)
        .then((url) => {
            // Muestra el contenedor del PDF
            const pdfContainer = document.getElementById("pdf-container-proceso");
            pdfContainer.style.display = "block";

            // Establece la URL del PDF en el iframe
            const pdfViewer = document.getElementById("pdf-viewer-proceso");
            pdfViewer.src = url;
        })
        .catch((error) => {
            console.error("Error al obtener el archivo:", error);
        });
});

// Manejar clic fuera del contenedor para cerrar el PDF
document.addEventListener("click", (event) => {
    // Selecciona el contenedor y el visor del PDF
    const pdfContainer = document.getElementById("pdf-container-proceso");
    const pdfViewer = document.getElementById("pdf-viewer-proceso");

    // Verifica si el clic ocurri√≥ fuera del contenedor
    if (
        pdfContainer.style.display === "block" && // Solo si el contenedor est√° visible
        !pdfContainer.contains(event.target) // Si el clic no es dentro del contenedor
    ) {
        pdfContainer.style.display = "none"; // Oculta el contenedor
        pdfViewer.src = ""; // Limpia el contenido del iframe
    }
});

document.getElementById("btn-calidad").addEventListener("click", () => {
    // Referencia al archivo en Firebase Storage
    const fileRef = ref(storage, "Manual de Gesti√≥n AyL BD.pdf");

    // Obt√©n la URL de descarga
    getDownloadURL(fileRef)
        .then((url) => {
            // Muestra el contenedor del PDF
            const pdfContainer = document.getElementById("pdf-container-calidad");
            pdfContainer.style.display = "block";

            // Establece la URL del PDF en el iframe
            const pdfViewer = document.getElementById("pdf-viewer-calidad");
            pdfViewer.src = url;
        })
        .catch((error) => {
            console.error("Error al obtener el archivo:", error);
        });
});

// Manejar clic fuera del contenedor para cerrar el PDF
document.addEventListener("click", (event) => {
    const pdfContainer = document.getElementById("pdf-container-calidad");
    const pdfViewer = document.getElementById("pdf-viewer-calidad");

    if (
        pdfContainer.style.display === "block" &&
        !pdfContainer.contains(event.target)
    ) {
        pdfContainer.style.display = "none";
        pdfViewer.src = "";
    }
});


//FUNCION PARA REQUISITOS 
// Encapsulamos todo dentro de un namespace para evitar conflictos
const TabManager = (() => {
    // Funci√≥n para mostrar el contenido de las pesta√±as
    function showTabContent(tabId) {
        const tabContents = document.querySelectorAll('.tab-content');

        // Ocultar todas las pesta√±as
        tabContents.forEach((content) => {
            content.classList.remove('active');
        });

        // Mostrar solo la pesta√±a correspondiente
        const activeTab = document.getElementById(tabId);
        if (activeTab) {
            activeTab.classList.add('active');
        } else {
            console.error(`No se encontr√≥ la pesta√±a con ID: ${tabId}`);
        }

        // Cambiar el estado de las pesta√±as
        const tabs = document.querySelectorAll('.tabs div');
        tabs.forEach((tab) => {
            tab.classList.remove('active');
        });

        const activeTabButton = document.getElementById(`tab-${tabId}`);
        if (activeTabButton) {
            activeTabButton.classList.add('active');
        }
    }

    // Funci√≥n espec√≠fica para manejar la pesta√±a "Requisitos"
    function handleRequisitosTab(tabId) {
        const requisitosContent = document.getElementById('requisitos-content');
        if (!requisitosContent) {
            console.error('No se encontr√≥ el contenedor de requisitos.');
            return;
        }

        // Cargar contenido din√°mico en base al tabId
        switch (tabId) {
            case 'contexto':
                requisitosContent.innerHTML = `
                    <h3>4. Contexto</h3>
                    <ul>
                        <li>4.1 Comprensi√≥n de la organizaci√≥n y su contexto</li>
                        <li>4.2 Comprensi√≥n de las necesidades y expectativas de las partes</li>
                        <li>4.3 Determinaci√≥n del alcance del sistema de gesti√≥n de la calidad</li>
                        <li>4.4 Sistema de gesti√≥n de la calidad y sus procesos</li>
                    </ul>
                `;
                break;
            case 'liderazgo':
                requisitosContent.innerHTML = `
                    <h3>5. Liderazgo</h3>
                    <ul>
                        <li>5.1 Liderazgo y compromiso</li>
                        <li>5.2 Pol√≠tica</li>
                        <li>5.3 Roles, responsabilidades y autoridades organizacionales</li>
                    </ul>
                `;
                break;
            default:
                requisitosContent.innerHTML = `<p>Contenido no disponible para la pesta√±a seleccionada.</p>`;
                break;
        }
    }

    // Exponemos las funciones necesarias
    return {
        showTabContent,
        handleRequisitosTab,
    };
})();

// Eventos para manejar las pesta√±as
document.addEventListener('DOMContentLoaded', () => {
    const tabs = document.querySelectorAll('.tabs div');

    tabs.forEach((tab) => {
        tab.addEventListener('click', () => {
            const tabId = tab.id.replace('tab-', '');
            TabManager.showTabContent(tabId);

            // Verificar si es la pesta√±a de "Requisitos"
            if (tabId === 'requisitos') {
                TabManager.handleRequisitosTab('contexto'); // Cargar el contenido inicial de Requisitos
            }
        });
    });

    // Carga inicial para la pesta√±a activa
    const activeTab = document.querySelector('.tabs div.active');
    if (activeTab) {
        const tabId = activeTab.id.replace('tab-', '');
        TabManager.showTabContent(tabId);
        if (tabId === 'requisitos') {
            TabManager.handleRequisitosTab('contexto'); // Cargar el contenido inicial
        }
    }
});

// Tabs de requisitos
document.addEventListener("DOMContentLoaded", () => {
    const tabs = document.querySelectorAll(".tabs div");
    const requisitosContent = document.getElementById("requisitos-content");
    const tableBody = document.getElementById("fileTableBody-requisitos");

    // Datos simulados para cada pesta√±a
    const requisitosData = {
        contexto: [
            { titulo: "4.1 Contexto", codigo: "CON-001", archivo: "Archivo1.pdf" },
            { titulo: "4.2 Necesidades", codigo: "CON-002", archivo: "Archivo2.pdf" },
        ],
        liderazgo: [
            { titulo: "5.1 Liderazgo", codigo: "LID-001", archivo: "Archivo3.pdf" },
            { titulo: "5.2 Pol√≠tica", codigo: "LID-002", archivo: "Archivo4.pdf" },
        ],
        // A√±ade m√°s datos aqu√≠ para las dem√°s pesta√±as
    };

    function loadTabContent(tabId) {
        tableBody.innerHTML = "";
        const data = requisitosData[tabId] || [];

        data.forEach((item) => {
            const row = `
                <tr>
                    <td>${item.titulo}</td>
                    <td>${item.codigo}</td>
                    <td><a href="#" class="file-link">${item.archivo}</a></td>
                </tr>
            `;
            tableBody.innerHTML += row;
        });
    }

    tabs.forEach((tab) => {
        tab.addEventListener("click", (e) => {
            tabs.forEach((t) => t.classList.remove("active"));
            tab.classList.add("active");

            const tabId = tab.id.replace("req-tab-", "");
            loadTabContent(tabId);
        });
    });

    // Cargar la primera pesta√±a por defecto
    loadTabContent("contexto");
});

//FUNCION PARA ORGRANIGRAMA 
document.addEventListener("DOMContentLoaded", function () {
    const modal = document.getElementById("orgChartModal");
    const closeBtn = document.getElementById("closeOrgChart");
    const openOrgChartBtn = document.getElementById("openOrgChart");

    // Mostrar el modal
    openOrgChartBtn.addEventListener("click", () => {
        modal.style.display = "block";
    });

    // Cerrar el modal
    closeBtn.onclick = () => {
        modal.style.display = "none";
    };

    // Cerrar el modal al hacer clic fuera del contenido
    window.onclick = (event) => {
        if (event.target === modal) {
            modal.style.display = "none";
        }
    };
});

//FUNCION PARA PROCESOS 
// Variables para la paginaci√≥n
let currentPageProcedimientos = 1;
const itemsPerPageProcedimientos = 5;

// Funci√≥n para cargar los archivos de procedimientos con paginaci√≥n
async function loadProcedimientosPaginated() {
    const fileTableBody = document.getElementById("fileTableBody-procedimientos");
    const paginationContainer = document.getElementById("pagination-container-procedimientos");
    fileTableBody.innerHTML = "";
    paginationContainer.innerHTML = "";

    // Obtener todos los archivos desde Firestore
    const querySnapshot = await getDocs(collection(db, "files-procedimientos"));
    const files = [];
    querySnapshot.forEach((doc) => {
        files.push(doc.data());
    });

    // Ordenar los archivos por nombre para consistencia
    files.sort((a, b) => a.name.localeCompare(b.name));

    // Calcular el n√∫mero total de p√°ginas
    const totalPages = Math.ceil(files.length / itemsPerPageProcedimientos);

    // Validar que la p√°gina actual no exceda el total de p√°ginas
    if (currentPageProcedimientos > totalPages) {
        currentPageProcedimientos = totalPages;
    }

    // Obtener los archivos de la p√°gina actual
    const start = (currentPageProcedimientos - 1) * itemsPerPageProcedimientos;
    const end = start + itemsPerPageProcedimientos;
    const currentFiles = files.slice(start, end);

    // Mostrar los archivos en la tabla
    currentFiles.forEach((fileData) => {
        const row = document.createElement("tr");

        const titleCell = document.createElement("td");
        titleCell.textContent = fileData.name;

        const codeCell = document.createElement("td");
        codeCell.textContent = fileData.code || "C√≥digo no encontrado";

        const fileCell = document.createElement("td");
        if (fileData.url) {
            const link = document.createElement("a");
            link.href = fileData.url;
            link.target = "_blank";
            link.classList.add("file-link");
            link.innerHTML = `<img src="https://img.icons8.com/ios-filled/50/000000/pdf.png" class="icon" /> Ver archivo`;
            fileCell.appendChild(link);
        } else {
            fileCell.textContent = "Sin Archivo";
            fileCell.classList.add("no-file");
        }

        row.appendChild(titleCell);
        row.appendChild(codeCell);
        row.appendChild(fileCell);
        fileTableBody.appendChild(row);
    });

    // Crear botones de paginaci√≥n
    for (let i = 1; i <= totalPages; i++) {
        const button = document.createElement("button");
        button.textContent = i;
        button.classList.add("pagination-button");
        if (i === currentPageProcedimientos) button.classList.add("active");
        button.addEventListener("click", () => {
            currentPageProcedimientos = i;
            loadProcedimientosPaginated();
        });
        paginationContainer.appendChild(button);
    }
}

// Subir archivos de procedimientos
document.getElementById("uploadBtn-procedimientos").addEventListener("click", async () => {
    const fileInput = document.getElementById("fileInput-procedimientos");
    const file = fileInput.files[0];

    if (!file) {
        alert("Por favor seleccione un archivo para subir.");
        return;
    }

    const code = await extractCodeFromPDF(file);

    try {
        const fileName = file.name;
        const storageRef = ref(storage, `uploads/procedimientos/${fileName}`);
        await uploadBytes(storageRef, file);
        const downloadURL = await getDownloadURL(storageRef);

        await addDoc(collection(db, "files-procedimientos"), {
            name: fileName,
            url: downloadURL,
            code: code,
            date: new Date().toLocaleDateString()
        });

        loadProcedimientosPaginated();
        fileInput.value = "";
    } catch (error) {
        console.error("Error al subir el archivo:", error.message);
        alert("Error al subir el archivo: " + error.message);
    }
});

// Cargar los archivos de procedimientos al inicio
document.getElementById("tab-procedimientos").addEventListener("click", () => {
    showTabContent("procedimientos");
    loadProcedimientosPaginated();
});


// Manejar el clic en la pesta√±a "Pol√≠tica de Inocuidad"
document.getElementById("tab-inocuidad").addEventListener("click", () => {
    showTabContent("inocuidad");
});


     </script>
</body>
</html>
